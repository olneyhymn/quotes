<!DOCTYPE html>
<html>
{{ partial "header.html" . }}
<script src="/semantic-search.js"></script>
<script src="/search-ui.js"></script>

<body>
	<div class="container wrapper post">
		{{ partial "head.html" . }}

    <div id="search-status" style="padding: 10px; margin-bottom: 20px; background: #f0f0f0; border-radius: 5px;">
      <span id="status-text">Initializing semantic search...</span>
    </div>
    <div id="app"></div>
  </div>

{{ partial "feedback.html" . }}
{{ partial "footer.html" . }}
</body>
</html>

{{- $p := slice -}}
{{- range .Site.RegularPages -}}
  {{- $post := dict "link" .RelPermalink "title" .Title "content" .Content "authors" .Params.Authors -}}
  {{- $p = $p | append $post -}}
{{- end -}}

<script>
  // Parse Hugo-generated posts data
  const posts = JSON.parse({{- $p | jsonify -}});

  // Get search query from URL
  const query = new URLSearchParams(window.location.search);
  const searchString = query.get('q');

  // Set search input value if it exists
  const searchInput = document.querySelector('#search');
  if (searchInput && searchString) {
    searchInput.value = searchString;
  }

  // Create a lookup by slug for additional metadata
  const postsBySlug = posts.reduce((acc, curr) => {
    const slug = curr.link.replace(/^\//, '').replace(/\/$/, '');
    acc[slug] = curr;
    return acc;
  }, {});

  // Initialize search UI
  const searchUI = new SearchUI(window.semanticSearch, postsBySlug);

  // Perform search
  searchUI.performSearch(searchString);
</script>
